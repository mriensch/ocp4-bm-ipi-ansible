- name: "{{ role_name }} | Create list of Catalog sources"
  find: 
    paths: "{{ item.path }}"
    patterns: 'Catalog.*yaml'
  register: oc_mirror_catalogs

- name: "{{ role_name }} | Apply the Catalog sources generated by oc-mirror"
  command:
    cmd: "oc apply -f {{ item }}"
  with_items: "{{ item.path }}"

- name: "{{ role_name }} | Copy the ODF ICSP to the correct location"
  template:
    src: imageContentSourcePolicy-odf.yaml.j2
    dest: '{{ item.path }}/imageContentSourcePolicy-odf.yaml'

- name: "{{ role_name }} | Create list of ICSPs | image Content Source Policy"
  find: 
    paths: "{{ item.path }}"
    patterns: 'image.*yaml'
  register: oc_mirror_icsp

- name: "{{ role_name }} | Apply the ICSPs sources generated by oc-mirror"
  command:
    cmd: "oc apply -f {{ item }}"
  with_items: "{{ oc_mirror_icsp.files }}"
